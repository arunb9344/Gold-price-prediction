<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gold Today vs Tomorrow</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 20px;
    }
    .card {
      max-width: 420px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    .title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 15px;
    }
    .result {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }
    .up { color: green; }
    .down { color: red; }
    .note {
      margin-top: 10px;
      font-size: 12px;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="card" id="goldCard">
  <div class="title">Loading...</div>
</div>

<script>
const API_KEY = "YOUR_METALS_DEV_API_KEY";
const BASE_URL = "https://api.metals.dev/v1";

async function fetchLatestGold() {
  const res = await fetch(`${BASE_URL}/latest?api_key=${API_KEY}&symbols=XAU`);
  const data = await res.json();
  return data.rates.XAU;
}

async function fetchHistoricalGold(date) {
  const res = await fetch(
    `${BASE_URL}/historical?api_key=${API_KEY}&symbols=XAU&date=${date}`
  );
  const data = await res.json();
  return data.rates.XAU;
}

function formatDate(d) {
  return d.toISOString().split("T")[0];
}

async function buildCard() {
  const now = new Date();
  const minutes = now.getHours() * 60 + now.getMinutes();
  const card = document.getElementById("goldCard");

  let title, leftLabel, rightLabel;
  let leftPrice, rightPrice;
  let noteText = "";

  // ðŸ•š 11:45 PM Logic
  if (minutes >= 1425) {
    title = "Today vs Tomorrow (Opening)";
    const today = new Date(now);
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);

    leftLabel = `Today (${formatDate(today)})`;
    rightLabel = `Tomorrow (${formatDate(tomorrow)})`;

    leftPrice = await fetchLatestGold();
    rightPrice = leftPrice; // Opening indication

    noteText = "Checked at 11:45 PM â€“ pre-opening suggestion";

  }
  // ðŸŒ… 8:45 AM Logic
  else if (minutes >= 525) {
    title = "Yesterday vs Today";
    const yesterday = new Date(now);
    yesterday.setDate(yesterday.getDate() - 1);

    leftLabel = `Yesterday (${formatDate(yesterday)})`;
    rightLabel = `Today (${formatDate(now)})`;

    leftPrice = await fetchHistoricalGold(formatDate(yesterday));
    rightPrice = await fetchLatestGold();

    noteText = "Checked after 8:45 AM â€“ market confirmation";
  }
  else {
    card.innerHTML = `<div class="title">Check after 8:45 AM or 11:45 PM</div>`;
    return;
  }

  const diff = rightPrice - leftPrice;
  const arrow = diff > 0 ? "â–²" : diff < 0 ? "â–¼" : "â€”";
  const cls = diff > 0 ? "up" : diff < 0 ? "down" : "";

  card.innerHTML = `
    <div class="title">${title}</div>

    <div class="row">
      <span>${leftLabel}</span>
      <span>${leftPrice.toFixed(2)}</span>
    </div>

    <div class="row">
      <span>${rightLabel}</span>
      <span>${rightPrice.toFixed(2)}</span>
    </div>

    <div class="result ${cls}">
      ${arrow} ${diff.toFixed(2)}
    </div>

    <div class="note">${noteText}</div>
  `;
}

buildCard();
</script>

</body>
</html>
